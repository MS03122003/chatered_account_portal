{% extends 'base.html' %}

{% block title %}View Customer{% endblock %}
{% block page_title %}Customer Details{% endblock %}

{% block content %}
<div class="container-fluid my-4">
    <div class="row justify-content-center">
        <div class="col-12 col-lg-10">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="fw-bold mb-0">Customer Details: {{ customer.customer_name }} ({{ customer.customer_id }})</h3>
                <div class="d-flex gap-2">
                    <a href="{% url 'edit_customer' customer.id %}" class="btn btn-primary">
                        <i class="fas fa-edit me-1"></i>Edit Customer
                    </a>
                    <a href="{% url 'customer' %}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-1"></i>Back to Customers
                    </a>
                </div>
            </div>

            <!-- Messages -->
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}

            <div class="bg-white rounded-4 shadow px-4 py-4 py-md-5">
                <!-- Basic Information Section -->
                <div class="section-header mb-4">
                    <h5 class="fw-bold text-primary border-bottom pb-2 mb-3">
                        <i class="fas fa-user me-2"></i>Basic Information
                    </h5>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="info-field">
                                <label class="form-label fw-semibold">Customer ID:</label>
                                <div class="info-value">{{ customer.customer_id }}</div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="info-field">
                                <label class="form-label fw-semibold">Customer Name:</label>
                                <div class="info-value">
                                    <div class="d-flex align-items-center">
                                        <div class="avatar-circle me-2">
                                            {{ customer.customer_name|first|upper }}
                                        </div>
                                        {{ customer.customer_name }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="info-field">
                                <label class="form-label fw-semibold">Mobile No:</label>
                                <div class="info-value">
                                    <i class="fas fa-phone text-success me-1"></i>
                                    <a href="tel:+91{{ customer.mobile_no }}" class="text-decoration-none">+91 {{ customer.mobile_no }}</a>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="info-field">
                                <label class="form-label fw-semibold">Email ID:</label>
                                <div class="info-value">
                                    {% if customer.email_id %}
                                        <i class="fas fa-envelope text-info me-1"></i>
                                        <a href="mailto:{{ customer.email_id }}" class="text-decoration-none">{{ customer.email_id }}</a>
                                    {% else %}
                                        <span class="text-muted">Not provided</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Family Information Section -->
                <div class="section-header mb-4">
                    <h5 class="fw-bold text-primary border-bottom pb-2 mb-3">
                        <i class="fas fa-users me-2"></i>Family Information
                    </h5>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="info-field">
                                <label class="form-label fw-semibold">Father's Name:</label>
                                <div class="info-value">{{ customer.father_name|default:"Not provided" }}</div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="info-field">
                                <label class="form-label fw-semibold">Mother's Name:</label>
                                <div class="info-value">{{ customer.mother_name|default:"Not provided" }}</div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="info-field">
                                <label class="form-label fw-semibold">Spouse Name:</label>
                                <div class="info-value">{{ customer.spouse_name|default:"Not provided" }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Document Information Section -->
                <div class="section-header mb-4">
                    <h5 class="fw-bold text-primary border-bottom pb-2 mb-3">
                        <i class="fas fa-id-card me-2"></i>Document Information
                    </h5>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="info-field">
                                <label class="form-label fw-semibold">Aadhar Card No:</label>
                                <div class="info-value">
                                    {% if customer.aadhar_card_no %}
                                        <span class="badge bg-light text-dark">{{ customer.aadhar_card_no }}</span>
                                    {% else %}
                                        <span class="text-muted">Not provided</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="info-field">
                                <label class="form-label fw-semibold">PAN No:</label>
                                <div class="info-value">
                                    {% if customer.pan_no %}
                                        <span class="badge bg-light text-dark">{{ customer.pan_no }}</span>
                                    {% else %}
                                        <span class="text-muted">Not provided</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Company Information Section -->
                <div class="section-header mb-4">
                    <h5 class="fw-bold text-primary border-bottom pb-2 mb-3">
                        <i class="fas fa-building me-2"></i>Company Information
                    </h5>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="info-field">
                                <label class="form-label fw-semibold">Company Name:</label>
                                <div class="info-value">{{ customer.company_name|default:"Individual/Personal" }}</div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="info-field">
                                <label class="form-label fw-semibold">GST No:</label>
                                <div class="info-value">
                                    {% if customer.gst_no %}
                                        <span class="badge bg-light text-dark">{{ customer.gst_no }}</span>
                                    {% else %}
                                        <span class="text-muted">Not provided</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="info-field">
                                <label class="form-label fw-semibold">CIN No:</label>
                                <div class="info-value">
                                    {% if customer.cin_no %}
                                        <span class="badge bg-light text-dark">{{ customer.cin_no }}</span>
                                    {% else %}
                                        <span class="text-muted">Not provided</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Services Section -->
                <div class="section-header mb-4">
                    <h5 class="fw-bold text-primary border-bottom pb-2 mb-3">
                        <i class="fas fa-cogs me-2"></i>Services & Pricing
                    </h5>
                    {% if services %}
                        <div class="services-list">
                            {% for service in services %}
                                <div class="service-item card mb-2 p-3" style="background: #f8f9fa; border-left: 4px solid #035dc5;">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1 fw-semibold">{{ service.service.name }}</h6>
                                            <small class="text-muted">Service ID: {{ service.service.id }}</small>
                                        </div>
                                        <div class="text-end">
                                            <span class="badge bg-success fs-6">₹{{ service.service_price }}</span>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                            <div class="text-end mt-3 p-3 bg-light rounded">
                                <h5 class="mb-0 fw-bold text-success">
                                    Total Amount: ₹{{ total_amount|default:0 }}
                                </h5>
                            </div>
                        </div>
                    {% else %}
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            No services have been added to this customer yet.
                            <div class="mt-2">
                                <a href="{% url 'edit_customer' customer.id %}" class="btn btn-sm btn-primary">
                                    <i class="fas fa-plus me-1"></i>Add Services
                                </a>
                            </div>
                        </div>
                    {% endif %}
                </div>

                <!-- Document Upload Section -->
                {% if customer.upload_document %}
                    <div class="section-header mb-4">
                        <h5 class="fw-bold text-primary border-bottom pb-2 mb-3">
                            <i class="fas fa-file-upload me-2"></i>Uploaded Document
                        </h5>
                        <div class="mb-2">
                            <label class="form-label fw-semibold">Document Name:</label>
                            <div class="info-value">
                                {{ customer.document_name|default:customer.upload_document.name }}
                            </div>
                        </div>
                        <div class="document-preview p-4 bg-light rounded border">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-file-alt text-primary me-3 fs-3"></i>
                                    <div>
                                        <h6 class="mb-1 fw-semibold">{{ customer.get_document_filename|default:"Document" }}</h6>
                                        <small class="text-muted">
                                            <i class="fas fa-calendar-alt me-1"></i>
                                            Uploaded on {{ customer.created_at|date:"d M Y, h:i A" }}
                                        </small>
                                    </div>
                                </div>
                                <div class="d-flex gap-2">
                                    <a href="{{ customer.upload_document.url }}" target="_blank" class="btn btn-outline-primary">
                                        <i class="fas fa-eye me-1"></i>View
                                    </a>
                                    <a href="{{ customer.upload_document.url }}" download class="btn btn-outline-success">
                                        <i class="fas fa-download me-1"></i>Download
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}

                <!-- Notes Section -->
                <div class="section-header mb-4">
                    <h5 class="fw-bold text-primary border-bottom pb-2 mb-3">
                        <i class="fas fa-sticky-note me-2"></i>Notes
                    </h5>
                    <div class="notes-content p-3 bg-light rounded">
                        {% if customer.note %}
                            <p class="mb-0">{{ customer.note|linebreaks }}</p>
                        {% else %}
                            <p class="mb-0 text-muted fst-italic">No notes added for this customer.</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Customer Status Section -->
                <div class="section-header mb-4">
                    <h5 class="fw-bold text-primary border-bottom pb-2 mb-3">
                        <i class="fas fa-chart-line me-2"></i>Customer Status
                    </h5>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <div class="status-card p-3 bg-primary text-white rounded">
                                <div class="text-center">
                                    <i class="fas fa-handshake fa-2x mb-2"></i>
                                    <h6 class="mb-1">Status</h6>
                                    <span class="badge bg-light text-primary">Active Customer</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="status-card p-3 bg-success text-white rounded">
                                <div class="text-center">
                                    <i class="fas fa-calendar-check fa-2x mb-2"></i>
                                    <h6 class="mb-1">Services Count</h6>
                                    <h4 class="mb-0">{{ services|length }}</h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="status-card p-3 bg-info text-white rounded">
                                <div class="text-center">
                                    <i class="fas fa-rupee-sign fa-2x mb-2"></i>
                                    <h6 class="mb-1">Total Value</h6>
                                    <h4 class="mb-0">₹{{ total_amount|default:0 }}</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Audit Information Section -->
                <div class="section-header mb-0">
                    <h5 class="fw-bold text-primary border-bottom pb-2 mb-3">
                        <i class="fas fa-clock me-2"></i>Audit Information
                    </h5>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="info-field">
                                <label class="form-label fw-semibold">Created Date:</label>
                                <div class="info-value">
                                    <i class="fas fa-calendar-plus text-success me-1"></i>
                                    {{ customer.created_at|date:"d M Y, h:i A" }}
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="info-field">
                                <label class="form-label fw-semibold">Last Updated:</label>
                                <div class="info-value">
                                    <i class="fas fa-calendar-check text-warning me-1"></i>
                                    {{ customer.updated_at|date:"d M Y, h:i A"|default:"Not updated" }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <hr class="my-4">
                <div class="d-flex justify-content-center gap-3">
                    <a href="{% url 'edit_customer' customer.id %}" class="btn btn-primary px-5 py-2" style="font-size:1.2rem; font-weight:600;">
                        <i class="fas fa-edit me-2"></i>Edit Customer
                    </a>
                    <a href="{% url 'customer' %}" class="btn btn-secondary px-4 py-2" style="font-size:1.2rem;">
                        <i class="fas fa-arrow-left me-2"></i>Back to Customers
                    </a>
                    <button class="btn btn-success px-4 py-2" onclick="printCustomerDetails()" style="font-size:1.2rem;">
                        <i class="fas fa-print me-2"></i>Print Details
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function printCustomerDetails() {
    window.print();
}
</script>

<style>
    .bg-white {
        background: #fff !important;
    }
    
    .section-header {
        margin-bottom: 1.5rem;
    }
    
    .info-field {
        margin-bottom: 1rem;
    }
    
    .form-label {
        font-weight: 600;
        color: #495057;
        margin-bottom: 0.25rem;
    }
    
    .info-value {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 7px;
        padding: 0.75rem;
        min-height: 45px;
        display: flex;
        align-items: center;
        font-size: 0.95rem;
    }
    
    .text-primary {
        color: #035dc5 !important;
    }
    
    .service-item {
        transition: all 0.3s ease;
    }
    
    .service-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .document-preview {
        transition: all 0.3s ease;
    }
    
    .document-preview:hover {
        background: #e9ecef !important;
    }
    
    .badge {
        font-size: 0.85em;
        font-family: 'Courier New', monospace;
        letter-spacing: 1px;
    }
    
    .notes-content {
        border-left: 4px solid #035dc5;
    }
    
    .status-card {
        transition: all 0.3s ease;
    }
    
    .status-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }
    
    .avatar-circle {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: #035dc5;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 1.1rem;
        flex-shrink: 0;
    }
    
    hr {
        border-top: 1.5px solid #eee;
    }
    
    .border-bottom {
        border-bottom: 2px solid #035dc5 !important;
    }
    
    @media (max-width: 700px) {
        .bg-white {
            padding: 16px 4vw !important;
        }
        
        .col-md-6, .col-md-4 {
            flex: 0 0 100% !important;
            max-width: 100% !important;
        }
        
        .d-flex.gap-2, .d-flex.gap-3 {
            flex-direction: column;
            gap: 0.5rem !important;
        }
        
        .btn {
            width: 100%;
            text-align: center;
        }
        
        .document-preview .d-flex {
            flex-direction: column;
            align-items: flex-start !important;
            gap: 1rem;
        }
        
        .document-preview .d-flex:last-child {
            flex-direction: row;
            width: 100%;
        }
        
        .service-item .d-flex {
            flex-direction: column;
            align-items: flex-start !important;
            gap: 0.5rem;
        }
        
        .status-card {
            margin-bottom: 1rem;
        }
    }
    
    /* Animation for sections */
    .section-header {
        animation: fadeInUp 0.6s ease-out;
    }
    
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* Custom scrollbar for better UX */
    ::-webkit-scrollbar {
        width: 8px;
    }
    
    ::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
        background: #035dc5;
        border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
        background: #024a9f;
    }

    /* Print styles */
    @media print {
        .btn, .d-flex.gap-3:last-child {
            display: none !important;
        }
        
        .shadow {
            box-shadow: none !important;
        }
        
        .bg-white {
            background: white !important;
        }
        
        .section-header {
            page-break-inside: avoid;
        }
    }
</style>
{% endblock %}